\documentclass[a4paper,12pt,landscape]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[francais]{babel}
\usepackage{amsfonts}
\usepackage[margin=2.5cm]{geometry}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{array}
\usepackage{wrapfig}
\usepackage{eso-pic}

\newcommand\BackgroundPic{%
\put(0,0){%
\parbox[b][\paperheight]{\paperwidth}{%
\vfill
\centering
\includegraphics[width=\paperwidth,height=\paperheight,%
keepaspectratio]{matlabresult.png}%
\vfill
}}}
\begin{document}
\AddToShipoutPicture*{\BackgroundPic}
\title{Projet EDMO}
\author{Annie Cathignol\\Louis Becquey\\3-BIM}
\date{\today}
\begin{center}
.\\
\end{center}



\newpage

\section{Questions de Cours}
\subsection{Résultat 1}
{\it \bf Pour toute fonction f assez régulière (de classe $C^{p}$ ), le schéma explicite à un pas est consistant d’ordre p avec le problème de Cauchy correspondant si:}\\
\begin{center}
$\Phi (t,x,0) = f(t,x)$ ,  \\
$\frac{\partial \Phi}{\partial h} (t,x,0) = \frac{1}{2}Df(t,x)$ , \\
$\vdots$ \\
$\frac{\partial^{p-1}\Phi}{\partial h^{p-1}} (t,x,0) = \frac{1}{p}D^{p-1}f(t,x)$ , \\
\end{center}

\paragraph{Démonstration:} On connait l'erreur de consistance :
$$\tau_n = x(t_{n+1})-x(t_{n})-h \Phi (t_n, x(t_n),h)$$
Si on applique la formule de Taylor-Lagrange à $x(t_{n+1}) - x(t_n)$, $\exists  c \in ]t_n, t_{n+1}[ $tel que :
\[ x(t_{n+1}) - x(t_n) = \sum_{k=1}^p \frac{(t_{n+1}-t_n)^k}{k!}\frac{d^k}{dt^k}x(t_n) + \frac{(t_{n+1}-t_n)^{p+1}}{(p+1)!}\frac{d^{p+1}}{dt^{p+1}}x(c)\]
Et comme $h=t_{n+1}-t_n$: 
\[ x(t_{n+1}) - x(t_n) = \sum_{k=1}^{p} \frac{h^{k}}{k!}\frac{d^{k}}{dt^{k}}x(t_n) + \frac{h^{p+1}}{(p+1)!}\frac{d^{p+1}}{dt^{p+1}}x(c)= \sum_{k=1}^{p} \frac{h^{k}}{k!}f^{(k-1)}_{(t_n, x(t_n))} + \frac{h^{p+1}}{(p+1)!}f^{(p)}_{(c, x(c))}\]
De même pour $\Phi$, il existe $d \in ]0,h[ $ tel que :
\[\phi(t_n,x(t_n),h) = \sum_{k=0}^{p-1} \frac{h^{k}}{k!}\frac{\partial ^{k}\phi}{\partial h^{k}}|_{(t_n,x(t_n),0)} + \frac{h^{p}}{p!}\frac{\partial ^{p}\phi}{\partial h^{p}}|_{(t_n, x(t_n), d)}
\]
Donc l'erreur de consistance s'écrit 
$$\tau_n = h\sum^p_{k=1} \frac{h^{k-1}}{k!}f^{(k-1)}_{(t_n, x(t_n))} + \frac{h^{p+1}}{(p+1)!}f^{(p)}_{(c, x(c))} - h\sum^{p-1}_{k=0}\frac{h^k}{k!}\times \frac{\partial^k\Phi}{\partial h^k}|_{(t_n, x(t_n), 0)} - \frac{h^{p+1}}{p!}\times \frac{\partial^p\Phi}{\partial h^p}|_{(t_n, x(t_n), d)}$$
$$= h\sum^{p-1}_{k=0}\left[\frac{h^k}{k!}\left(\frac{f^{(k)}_{(t_n, x(t_n))}}{k+1}-\frac{\partial^k\phi}{\partial h^k}|_{(t_n, x(t_n), 0)}\right) \right] + \frac{h^{p+1}}{p!}\left[\frac{f^{(p)}_{(c, x(c))}}{p+1}-\frac{\partial^p\phi}{\partial h^p}|_{(t_n, x(t_n), d)}\right]$$
Et dans notre cas on a $\frac{\partial f}{\partial t}=Df$, donc
$$\tau_n= h\sum^{p-1}_{k=0}\left[\frac{h^k}{k!}\left(\frac{D^kf_{(t_n, x(t_n))}}{k+1}-\frac{\partial^k\phi}{\partial h^k}|_{(t_n, x(t_n), 0)}\right) \right] + \frac{h^{p+1}}{p!}\left[\frac{D^pf_{(c, x(c))}}{p+1}-\frac{\partial^p\phi}{\partial h^p}|_{(t_n, x(t_n), d)}\right]$$
Donc si $\forall k \in |[0,p-1]|$,
$\frac{\partial^k\phi}{\partial h^k}|_{(t,x,0)} = \frac{D^{k}f_{(t,x)}}{k+1}$
on obtient :
\[\tau_n = \frac{h^{p+1}}{p!}\left[\frac{D^pf_{(c, x(c))}}{p+1}-\frac{\partial^p\phi}{\partial h^p}|_{(t_n, x(t_n), d)}\right]
=o(h^p)$$
Ainsi le schéma explicite à un pas est consistant d'ordre p avec le problème de Cauchy.\\

Donc, pour toute fonction f assez régulière (de classe $C^{p}$ ), le schéma explicite à un pas est consistant d’ordre p avec le problème de Cauchy correspondant si pour k de 0 à $p-1$, on a:
\begin{center}
$\frac{\partial^{k}\phi}{\partial h^{k}} (t,x,0) = \frac{1}{k+1}D^{k}f(t,x)$ . \\
\end{center}
\newpage


\subsection{Résultat 2}
{\it \bf Pour qu’un schéma de Runge-Kutta explicite à un pas soit au-moins d’ordre 2, il faut et il suffit que les points $b_{i}$, les poids intermédiaires $a_{i,j}$ et les paramètres $c_{i}$ (i, j variant de 1 à s) vérifient:} $$\sum_{i=1}^{s}b_{i}c_{i} = \frac{1}{2} \; \textrm{   d'une part, et d'autre part   } \; \sum_{i=1}^{s}b_{i}\left(\sum_{j=1}^{i-1}a_{ij}\right)= \frac{1}{2}$$


\paragraph{Démonstration:} On sait que : 
\begin{equation}\phi(t_n,x_n,h_n)=\sum_{i=1}^{s} b_i f(t_n+c_i h_n,X_i) \textrm{ avec } X_i=x_n+h_n\sum^{i-1}_{j=1} a_{i,j} f(t_n+c_jh_n,X_j)
\end{equation}
Et si le schéma est d'ordre au moins 2, 
\begin{equation}\frac{\partial}{\partial h}\phi(t,x,0)=\frac{1}{2}Df(t,x)
\end{equation}
Calculons:
\begin{equation}\frac{\partial X_i}{\partial h}=\frac{\partial}{\partial h}(x_n+h_n\sum^{i-1}_{j=1} a_{ij} f(t_n+c_jh_n,X_j))=\sum^{i-1}_{j=1} a_{ij} f(t_n+c_jh_n,X_j)
\end{equation}
et:
\begin{equation}
\frac{\partial}{\partial h}\left[ b_if(t_n+c_ih_n,X_i)\right] = b_i . \frac{\partial}{\partial h}f(t_n+c_ih_n,X_i)= b_i \left( \frac{\partial f}{\partial (t_n+c_ih_n)}\frac{\partial (t_n+c_ih_n)}{\partial h}+\frac{\partial f}{\partial X_i}\frac{\partial X_i}{\partial h}\right)= b_i \left( \frac{\partial f}{\partial (t_n+c_ih_n)}c_i+\frac{\partial f}{\partial X_i}\frac{\partial X_i}{\partial h}\right)
\end{equation}
Donc, d'après $(1), (3)$ et $(4)$,
$$ \frac{\partial \phi}{\partial h} = \frac{\partial}{\partial h}\left[ \sum^{s}_{i=1} b_i f(t_n+c_i h_n,X_i)\right] = \sum^{s}_{i=1} b_i\left[ \frac{\partial f}{\partial (t_n+c_ih_n)}c_i+\frac{\partial f}{\partial X_i}\sum^{i-1}_{j=1} a_{i,j} f(t_n+c_jh_n,X_j) \right]\\ $$
$$= \sum^{s}_{i=1} b_ic_i\left( \frac{\partial f}{\partial (t_n+c_ih_n)}\right) +\sum^{s}_{i=1} b_i \left( \frac{\partial f}{\partial x_n}.\sum^{i-1}_{j=1} a_{ij} f(t_n+c_jh_n,X_j) \right)\\ $$
\\
Donc, si $h_n=0$ \textit{(et donc $X_j=x_n$)} :
\begin{equation}
\frac{\partial \phi}{\partial h}|_{(t,x,0)} = \frac{\partial f}{\partial t}|_{(t,x)}.\sum^{s}_{i=1} b_ic_i +  f(t,x).\frac{\partial f}{\partial x}|_{(t,x)}.\sum^{s}_{i=1} b_i\left(\sum^{i-1}_{j=1} a_{ij}\right)
\end{equation}
De plus on a $Df(t,x)=\frac{\partial f}{\partial t}|_{(t,x)}+f(t,x)\frac{\partial f}{\partial x}|_{(t,x)}$ donc selon $(2)$:
$$\frac{\partial \phi}{\partial h}|_{(t,x,0)}=\frac{1}{2}Df(t,x)= \frac{1}{2}\frac{\partial f}{\partial t}|_{(t,x)}+\frac{1}{2}f(t,x) \frac{\partial f}{\partial x}|_{(t,x)}$$
On en déduit donc d'après $(5)$ que par identification, pour que le schéma soit d'ordre au moins 2, il faut et
il suffit que les points $b_i$ , les poids intermédiaires $a_{ij}$ et les paramètres $c_i$
vérifient les conditions: 
$$\sum^{s}_{i=1} b_ic_i = \frac{1}{2}$$
$$\sum^{s}_{i=1} b_i \left(\sum^{i-1}_{j=1} a_{ij}\right) = \frac{1}{2}$$


\section{Exercice 1 - Problème raide}
On considère le problème de Cauchy suivant :
trouver $u \in C^{1}([0,1], \mathbb{R} )$ telle que
$$
(C) \left \{
\begin{array}{l}
	u'(t)= -150u(t) + 30 \\
	u(0) = 1
\end{array}
\right.
$$
\newpage
\subsection{}
Il s'agit d'une équation différentielle linéaire d'ordre 1, avec second membre, on peut trouver une solution exacte en procédant comme suit:\\
Partons de l'équation $$u' + 150u = 30$$
Multiplions chaque terme par $e^{150t}$ : $$u'.e^{150t}+150.e^{150t}.u = 30.e^{150t}$$
$$(u.e^{150t})'=30.e^{150t}$$
Intégrons entre 0 et t ($t \in [0,1]$): $$\int_{0}^{t}(u_{(s)}.e^{150s})'.ds = \int_{0}^{t}30.e^{150s}.ds$$
$$u_{(t)}.e^{150t}-u_{(0)} = {\left [ \frac{1}{5}e^{150s} \right ]}_{0}^{t}= \frac{1}{5}e^{150t}-\frac{1}{5}$$
$$u_{(t)} = { \left ( \frac{e^{150t}+4}{5} \right ) }e^{-150t}$$
$$u_{(t)} = \frac{1}{5}+\frac{4}{5}e^{-150t}$$
Cette fonction u est bien définie sur l'intervalle [0,1], vérifions qu'elle est bien solution du problème (C):\\

$u_{(0)}= \frac{1}{5}+\frac{4}{5}=\frac{5}{5}=1 \Rightarrow $ OK\\

$u'_{(t)}= -120e^{-150t}$\\

$-150 u_{(t)} +30 = -150{ \left( \frac{1}{5}+\frac{4}{5}e^{-150t} \right) } +30 = -30 -120e^{-150t} +30 = u'_{(t)} \Rightarrow $OK\\

Donc on a bien une solution exacte au problème de Cauchy.

On a donc quand $t \rightarrow \infty$, 
$$\lim_{t \rightarrow +\infty}u_{(t)}=\frac{1}{5}+\frac{4}{5} { \left( \lim_{t \rightarrow +\infty}e^{-150t} \right ) }= \frac{1}{5}.$$

\subsection{}
Considérons le schéma d'Euler explicite pour ce problème de Cauchy:
$$\left \{
\begin{array}{l}
	u_{n+1}= u_{n} + h f(t_n , u_n)\\
	u_0 = 1
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	u_{n+1}= u_{n} + h(-150 u_n + 30)\\
	u_0 = 1
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	u_{n+1}= (1-150h)u_{n} + 30h\\
	u_0 = 1
\end{array}
\right.$$
On peut écrire une relation de récurrence entre $u_{n+1}-\frac{1}{5}$ et $u_{n}-\frac{1}{5}$:
$$u_{n+1}-\frac{1}{5}= u_n - 150hu_n+30h-\frac{1}{5}= (u_n-\frac{1}{5})-150hu_n + 30h = (u_n-\frac{1}{5})-150h(u_n-\frac{1}{5})$$
$$(u_{n+1}-\frac{1}{5})= (u_n-\frac{1}{5})(1-150h)$$
Cette relation permet d'exprimer $u_n$ en fonction de n et h:\\
Soit $x_n=u_{n}-\frac{1}{5}$, on a $x_{n+1}=(1-150h)x_n$, donc par exemple $x_1=(1-150h).x_0$, puis $x_2=(1-150h)^2.x_0$, et on peut montrer par récurrence que, pour $n \in \mathbb{N}^*$,
$$x_n=(1-150h)^n.x_0$$
D'où $(u_n-\frac{1}{5})=(1-150h)^n(u_0-\frac{1}{5})$, et comme $u_0=1$:
$$u_n=\frac{4}{5}(1-150h)^n+\frac{1}{5}$$
Si l'on suppose ensuite $h=1/50$ constant, on peut ré-écrire l'expression précédente sous la forme: $$u_n=\frac{4}{5}(-2)^n+\frac{1}{5}$$ On constate que la limite de $u_n$ quand $t \rightarrow \infty$ n'existe pas avec ce schéma.\\
On peut donc en conclure que ce schéma d'Euler explicite n'est pas  asymptotiquement stable: Lorsqu'on fait de plus en plus d'itérations, on ne se rapproche pas de la solution exacte.

\subsection{}
Considérons donc plutôt un schéma d'Euler implicite {\it (On rappelle que comme h>0, (1+150h)>0 )}
$$\left \{
\begin{array}{l}
	u_{n+1}= u_{n} + h f(t_{n+1} , u_{n+1})\\
	u_0 = 1
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	u_{n+1}= u_{n} + h(-150 u_{n+1} + 30)\\
	u_0 = 1
\end{array}
\right.$$
$$\begin{array}{l}
	u_{n+1}=u_n - 150h u_{n+1} + 30h\\
	(150h +1)u_{n+1} = u_n + 30h\\
\end{array}
\Leftrightarrow
u_{n+1}=\frac{u_n+30h}{(1+150h)}$$
Cette fois, la relation de récurrence entre $u_{n+1}-\frac{1}{5}$ et $u_{n}-\frac{1}{5}$ donne:
$$(u_{n+1}-\frac{1}{5})=\frac{u_n+30h}{(1+150h)}-\frac{1}{5}=\frac{5(u_n+30h)-(1+150h)}{5(1+150h)}=\frac{(u_n+30h)-(\frac{1}{5}+30h)}{(1+150h)}=\frac{u_n+30h-\frac{1}{5}-30h}{(1+150h)}=\frac{(u_n-\frac{1}{5})}{(1+150h)}$$
Posons $x_n=u_{n}-\frac{1}{5}$, on a alors $x_{n+1}=x_n/(1+150h)$, donc par exemple $x_1=x_0/(1+150h)$, puis $x_2=x_0/(1+150h)^2$, et on peut montrer par récurrence que, pour $n \in \mathbb{N}^*$,
$$x_n=x_0/(1+150h)^n$$
D'où $(u_n-\frac{1}{5})=\frac{(u_0-\frac{1}{5})}{(1+150h)^n}$, et comme $u_0=1$:
$$u_n=\frac{4}{5}\frac{1}{(1+150h)^n}+\frac{1}{5}$$
Si l'on suppose ensuite $h=1/50$ constant, on peut ré-écrire l'expression précédente sous la forme: $$u_n=\frac{4}{5*4^n}+\frac{1}{5}$$
Cette fois, on peut écrire que $$\lim_{n \rightarrow +\infty}u_n = \frac{1}{5}\lim_{n \rightarrow +\infty}{ \left( \frac{1}{4^{n-1}} \right) }+\frac{1}{5}=\frac{1}{5}$$
Cette fois, on peut donc conclure que lorsqu'on augmente le nombre d'itérations, on converge vers la valeur numérique de la solution exacte: ce schéma d'Euler implicite est donc asymptotiquement stable.


\section{Exercice 2 - Une mise en jambe pour la programmation}

On considère le problème de Cauchy suivant :
trouver y définie sur [0,4] telle que
$$
(C2) \left \{
\begin{array}{l}
	y'(t)= 4e^{0.8t}-0.5y(t) \\
	y(0) = 2
\end{array}
\right.
$$
\subsection{}
On a un problème de Cauchy y'=f(t,y) où f(t,y) est continue sur $\mathbb{R}^2$: $f(t,y)=4e^{0.8t}-0.5y$. Cette même fonction est localement lipschitzienne par rapport à sa variable y, puisqu'elle est de classe $C^1$ dans [0,4].\\
Donc selon le théorème de Cauchy-Lipschitz, on a existence, unicité et régularité d'une solution y(t) définie sur au moins [0,4].\\

Cherchons la solution exacte du problème: il s'agit d'une équation différentielle linéaire du premier ordre avec second membre. Procédons comme suit:
$$y'+0.5y=4.e^{0.8t}$$
Multiplions chaque terme par $e^{0.5t}$ : $$(e^{0.5t}.y(t))'=4e^{1.3t}$$
Intégrons entre 0 et t: $${\left[ e^{0.5s}.y(s) \right]}^t_0={\left[ \frac{4}{1.3}e^{1.3s} \right]}^t_0$$
$$e^{0.5t}.y(t)-y(0)=\frac{4}{1.3}e^{1.3t}-\frac{4}{1.3}$$
$$y(t)={\left( \frac{4}{1.3}e^{1.3t}-\frac{4}{1.3}+2 \right)}e^{-0.5t}$$
$$y(t)=\frac{4}{1.3}e^{0.8t}+{\left( 2-\frac{4}{1.3} \right) }e^{-0.5t}$$
$$y(t)=\frac{4}{1.3}e^{0.8t} -\frac{1.4}{1.3} e^{-0.5t}$$
Cette fonction y est bien définie sur [0,4], et on a bien $y(0)=2$.

\subsection{}
Considérons le schéma d'Euler explicite associé à ce problème {\it (On a h=1)}:
$$\left \{
\begin{array}{l}
	y_{n+1}= y_n + h f(t_n,y_n)\\
	y_0 = 2
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	y_{n+1}= y_n + 4e^{0.8t_n}-0.5y_n\\
	y_0 = 2
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	y_{n+1}= 0.5y_n + 4e^{0.8t_n}\\
	y_0 = 2
\end{array}
\right.$$
\paragraph{A l'ordre 1}
Ici, $\Phi(t,y,h)$=f(t,y) qui est lipschitzienne par rapport à sa deuxième variable. Donc $\Phi$ est lipschitzienne par rapport à sa deuxième variable, donc le schéma est stable à l'ordre 1.\\
De plus, comme $\Phi(t,y,h)$=f(t,y) on a $\Phi(t,y,0)$=f(t,y), donc le schéma est consistant d'ordre 1 avec le problème de Cauchy.\\

Donc par le théorème de LAX, le schéma est convergent d'ordre au moins 1 vers la solution du problème de Cauchy.

\paragraph{A l'ordre 2}
Ici, $\Phi(t,y,h)$ est de classe $C^2$. Donc $\Phi$ est lipschitzienne par rapport à sa deuxième variable, donc le schéma est stable à l'ordre 2 également.\\
Cette fois par contre, $\frac{\partial \Phi}{\partial h} (t,y,0)=0 \neq \frac{1}{2}Df(t,y)$, donc le schéma n'est pas consistant à l'ordre 2.\\
\begin{wrapfigure}[1]{r}{10cm}
	\includegraphics[scale=0.45]{ex2.png}
	\caption{Comparaison entre méthode numérique et solution réelle sur l'intervalle [0,4]}
\end{wrapfigure}
Donc le schéma n'est convergent que d'ordre 1.

\subsection{}

Avec ce schéma (Euler explicite), nous obtenons les résultats suivants:\\
L'erreur reste élevée (converge vers 24.66\%), et on voit bien que\\ le schéma n'est pas asymptotiquement convergent.

\begin{table}[h]
\hspace{2cm}
\begin{tabular}{|c|c|c|c|}
\hline
	$t_i$ & $y(t_i)$ & $y_i$ & $\epsilon_i$ \\
\hline
	$t_0=0$ & $2$ & 2 & $10^{-14}\%$ \\
\hline
	$t_1=1$ & $\frac{4}{1.3}e^{0.8} -\frac{1.4}{1.3\sqrt{e}}\approx 6.19$ & $\approx 5$ & $19.3\%$ \\
\hline
	$t_2=2$ & $\frac{4}{1.3}e^{1.6} -\frac{1.4}{1.3e}\approx 14.84$ & $\approx 11.40$  & $23.2\%$ \\
\hline
	$t_3=3$ & $\frac{4}{1.3}e^{2.4} -\frac{1.4}{1.3e\sqrt{e}}\approx 33.68$& $\approx 25.51$ & $24.2\%$ \\
\hline
	$t_4=4$ & $\frac{4}{1.3}e^{3.2} -\frac{1.4}{1.3e^2}\approx 75.33$ & $ \approx 56.85$  & $24.5\%$ \\
\hline
\end{tabular}
\end{table}

\section{Exercice 3 - Comparaison entre plusieurs méthodes}
On considère le problème de Cauchy suivant pour $t\in [0,T]$:
$$
(C3) \left \{
\begin{array}{l}
	x'(t)= -tx(t) \\
	x(0) = x_0
\end{array}
\right.
$$
\subsection{}
On a un problème de Cauchy x'=f(t,x) où f(t,x) est continue sur $\mathbb{R}^2$: $f(t,x)=-tx$. Cette même fonction est localement lipschitzienne par rapport à sa variable x, puisqu'elle est de classe $C^1$ dans [0,T] comme dans tout $\mathbb{R}^2$.\\
Donc selon le théorème de Cauchy-Lipschitz, on a existence, unicité et régularité d'une solution x(t) définie sur au moins [0,T].\\

Cherchons la solution exacte du problème: il s'agit d'une équation différentielle du premier ordre à variables séparables. Ainsi,
$$\frac{x'}{x}=-t$$
$$\int_0^t\frac{x'_{(s)}}{x_{(s)}}.ds = - \int_0^t s.ds$$
$$ln(x_{(t)})-ln(x_0)=-\frac{1}{2}t^2$$
$$x(t)=x_0 e^{-\frac{1}{2}t^2}$$
Cette fonction est bien définie sur les intervalles positifs, et x(0) vaut bien $x_0$.
Vérifions:
$$x'(t)=-t x_0 e^{-\frac{1}{2}t^2}=-tx(t)$$
Donc il s'agit bien de la solution du problème de Cauchy.

\subsection{}
\subsubsection{Schéma d'Euler Explicite}
Considérons le schéma d'Euler explicite associé à ce problème {\it (On a h=0.3)}:
$$\left \{
\begin{array}{l}
	x_{n+1}= x_n + h f(t_n,x_n)\\
	x_0 
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	x_{n+1}= x_n -ht_nx_n\\
	x_0
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	x_{n+1}= (1-0.3t_n)x_n\\
	x_0
\end{array}
\right.$$
Ici, $\Phi(t,x,h)$=f(t,x) qui est lipschitzienne par rapport à sa deuxième variable. Donc $\Phi$ est lipschitzienne par rapport à sa deuxième variable, donc le schéma est stable.\\

\subsubsection{Schéma du point milieu}
Le schéma du point milieu associé \textit{(h vaut toujours 0.3)}:\\
$$\left \{
\begin{array}{l}
	x_{n+1}= x_n + h f(t_n+\frac{h}{2},x_n+\frac{h}{2}f(t_n,x_n))\\
	x_0 
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	x_{n+1}= x_n +0.3\left[ -\left( t_n+\frac{0.3}{2}\right) \left( x_n+\frac{0.3}{2}(-t_nx_n)\right) \right]\\
	x_0
\end{array}
\right.$$
$$\Leftrightarrow
\left \{
\begin{array}{l}
	x_{n+1}= x_n-0.3(t_n+0.15)(1-0.15t_n)x_n\\
	x_0
\end{array}
\right.
\Leftrightarrow
\left \{
\begin{array}{l}
	x_{n+1}= (1-0.3(t_n+0.15)(1-0.15t_n))x_n\\
	x_0
\end{array}
\right.$$
$\Phi(t,x,h)=-(t+\frac{h}{2})(x-\frac{h}{2}tx)$ est de classe $C^\infty$, donc suffisamment régulière. On la supposera donc lipschitzienne par rapport à sa deuxième variable, donc le schéma est stable.
\subsubsection{Schéma de Runge-Kutta-4}
Intéressons nous aussi au schéma de Runge-Kutta 4 associé à ce problème de Cauchy \textit{(h=0.3 constant)}:
$$\left \{
\begin{array}{l}
	x_0 \\
	X_1=x_n\\
	X_2=x_n-\frac{h}{2}t_nX_1\\
	X_3=x_n-\frac{h}{2}(t_n+\frac{h}{2})X_2\\
	X_4=x_n-h(t_n+\frac{h}{2})X_3\\
	x_{n+1}=x_n-h\left[\frac{1}{6}t_nX_1+\frac{1}{3}(t_n+\frac{h}{2})X_2+\frac{1}{3}(t_n+\frac{h}{2})X_3+\frac{1}{6}(t_n+h)X_4\right]
\end{array}
\right.
\left \{
\begin{array}{l}
	x_0 \\
	X_1=x_n\\
	X_2=x_n-0.15t_nx_n\\
	X_3=x_n-0.15(t_n+0.15)(x_n-0.15t_nx_n)\\
	X_4=x_n-0.3(t_n+0.15)(x_n-0.15(t_n+0.15)(x_n-0.15t_nx_n))\\
	x_{n+1}=x_n-0.3\left[\frac{1}{6}t_nX_1+\frac{1}{3}(t_n+0.15)X_2+\frac{1}{3}(t_n+0.15)X_3+\frac{1}{6}(t_n+0.3)X_4\right]
\end{array}
\right.$$\\
$\Phi(t,x,h)$ est un polynôme (de degré 1) par rapport à sa deuxième variable (x), donc $\Phi$ est suffisamment régulière. On la suppose lipschitzienne par rapport à sa deuxième variable, le schéma est donc stable.\\

\subsubsection{Ordre de consistance}
Pour déterminer l'ordre de consistance et de convergence, et pour nous éviter l'aspect calculatoire, on s'intéresse à la quantité $max | x(t_n) - x_n |$. On sait que le schéma converge à l'ordre p si et seulement si $max | x(t_n) - x_n | \leq Kh^p$.\\
Ainsi, la constante restant la même, $max | x(t_n) - x_n |$ varie comme $h^p$ quand h varie.\\

On se propose donc de calculer cette quantité $max | x(t_n) - x_n |$ en faisant varier le nombre N de points calculés dans l'intervalle [0,T]: On rappelle que le pas h est donné par $h=\frac{(T-0)}{N}$, donc $h^p=\frac{T^p}{N^p}$.\\

Les résultats observés pour les trois schémas sont réunis dans ce graphique:\\

\begin{table}[h!]
\begin{tabular}{cb{14cm}}
\subfloat[Erreur absolue maximale en fonction de N (échelle logarithmique)]{\includegraphics[scale=0.40]{ex3_erreur.png}}
\hspace{1cm}
&
\hspace{7mm} On remarque donc qu'à une constante près, $max | x(t_n) - x_n |$ varie comme $h^1$ pour le schéma d'Euler explicite, comme $h^2$ pour le schéma du point milieu, et comme $h^4$ pour le schéma de Runge-Kutta 4.
On peut donc dire que le schéma d'Euler explicite converge à l'ordre 1, celui du point milieu à l'ordre 2, et celui de Runge-Kutta converge à l'ordre 4.\vspace{1cm}
\\
\end{tabular}
\end{table}

\subsubsection{Stabilité asymptotique}
On applique le Test Linéaire Standard (TLS) aux schémas, et on observe le comportement asymptotique des trajectoires.

$$
(TLS)
\left \{
\begin{array}{l}
x'=-Lx\\
x(0)=x_0\\
\end{array}
\right.
$$
\begin{table}[h!]
\centering
\begin{tabular}{ccl}
\subfloat[Comportement asymptotique pour une condition (L,h)=(3,$\frac{1}{2}$) donnée]{\includegraphics[scale=0.40]{ex3_TLS-1.png}}
&
\subfloat[Comportement asymptotique pour une autre condition (L=5)]{\includegraphics[scale=0.40]{ex3_TLS-2.png}}
&
\subfloat[Comportement asymptotique pour une autre condition (L=8,h=1)]{\includegraphics[scale=0.40]{ex3_TLS-3.png}}
\\
\end{tabular}
\end{table}

On voit que dans les 3 cas, h est soumis à conditions par rapport à L: Les schémas ne sont donc pas inconditionnellement stables. Cherchons les conditions sur h pour que le schéma soit A-stable:
\newpage
\paragraph{pour Euler Explicite:}
On obtient donc la suite $x_{n+1}=x_n-hLx_n=x_n(1-hL)$ donc on peut montrer par récurrence que $x_{n}=x_0 (1-hL)^{n}$. Le schéma est A-stable si $x_n$ tend vers 0 quand n tend vers l'infini, c'est à dire si et seulement si:\\
$$-1<1-hL<1$$
$$-2<-hL<0$$
$$0<hL<2$$
$$h<2/L$$ 
Le schéma n'est A-stable que pour $h<\frac{2}{L}$.


\paragraph{pour le Point Milieu:}
En procédant de la même façon, on obtient la suite $x_{n+1}=x_n(1-Lh+L^2h)$. Par récurrence, on peut montrer que $x_n=x_0(1-Lh+L^2h)^n$. Le schéma est donc A-stable uniquement si:
$$-1<1-Lh+L^2h<1$$
$$-2<-Lh+L^2h<0$$
$$-2<h(L^2-L)<0$$
h étant positif, la condition $h(L^2-L)<0$ n'est vraie que pour $L\in[0,1]$. Donc le schéma est A-stable pour $h<\frac{-2}{L^2-L}$ avec $L\in[0,1]$.

\paragraph{pour Runge-Kutta 4:}
La suite est plus complexe, mais le même principe peut être appliqué:\\ $x_{n+1}=x_n(1-\frac{hL}{6}(2-hL(1-\frac{h}{2}L(1-\frac{h}{2}L)))-\frac{hL}{3}(2-\frac{h}{2}L-\frac{h}{2}L(1-\frac{h}{2}L)))$ donc on peut écrire $x_n=x_0\times K(h,L)^n$ où $K(h,L)$ est un polynôme de degré 4, donc non entièrement inclus dans l'intervalle $[-1,1]$, donc la stabilité asymptotique est bien soumise à conditions sur h et L.


Donc les trois schémas ne sont pas inconditionnellement stables, on devra soit faire attention aux pas de temps h choisis, soit préférer utiliser un schéma implicite.

\subsection{}
Ce qui fonctionne sur le test linéaire standard fonctionne de même sur le problème de Cauchy qui nous concerne:

Essayons avec MatLab de tracer l'apparence des solutions pour différentes conditions sur les paramètres $x_0$, T et h:\\
\begin{table}
\begin{tabular}{l}
Pour $h=0.1$:
\end{tabular}\\
\begin{tabular}{cccc}
\subfloat[T=30, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h1T30x02.png}}
&
\subfloat[T=50, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h1T50x02.png}}
&
\subfloat[T=30, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h1T30x01000.png}}
&
\subfloat[T=50, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h1T50x01000.png}}
\\
\end{tabular}
\begin{tabular}{l}
Pour $h=0.3$:
\end{tabular}\\
\begin{tabular}{cccc}
\subfloat[T=30, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h3T30x02.png}}
&
\subfloat[T=50, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h3T50x02.png}}
&
\subfloat[T=30, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h3T30x01000.png}}
&
\subfloat[T=50, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h3T50x01000.png}}
\\
\end{tabular}
\begin{tabular}{l}
Pour $h=0.5$:
\end{tabular}\\
\begin{tabular}{cccc}
\subfloat[T=30, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h5T30x02.png}}
&
\subfloat[T=50, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h5T50x02.png}}
&
\subfloat[T=30, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h5T30x01000.png}}
&
\subfloat[T=50, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h5T50x01000.png}}
\\
\end{tabular}
\end{table}
\begin{table}
\begin{tabular}{l}
Pour $h=1.1$:
\end{tabular}\\
\begin{tabular}{cccc}
\subfloat[T=15, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h11T30x02.png}}
&
\subfloat[T=20, $y_0$=2]{\includegraphics[scale=0.4]{ex3_3_h11T50x02.png}}
&
\subfloat[T=20, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h11T30x01000.png}}
&
\subfloat[T=50, $y_0$=1000]{\includegraphics[scale=0.4]{ex3_3_h11T50x01000.png}}
\\
\end{tabular}
\end{table}

On voit que $x_0$ n'a pas d'influence sur la stabilité. Par contre, h en a. T permet seulement de cacher ce défaut des schémas s'il est trop petit.\\

\newpage
\section{Exercice 4 - Problème d'équation Proie-Prédateur}

On considère le problème de Cauchy du modèle de Lotka-Volterra, avec $y_1$ et $y_2$ définies sur $\mathbb{R}^+$:
$$
(PP)
\left \{
\begin{array}{l}
	y'_1(t)=1.2y_1-0.6y_1y_2\\
	y'_2(t)=-0.8y_2+0.3y_1y_2\\
	y_1(0)=2\\
	y_2(0)=1\\
\end{array}
\right.$$\\
\subsection{}

L'évolution des proies à chaque génération est la différence de l'augmentation naturelle des proies par reproduction (soit ici +$1.2y_1$), qui est toujours positive ou nulle, et du nombre de proies mangées pendant la génération (à cause des prédateurs).\\

La réponse fonctionnelle (\textit{le nombre de proies mangées par prédateur et par unité de temps}) est dépendante du nombre de proies. Ici elle est de $0,6y_1$ proies/prédateur/temps, c'est une réponse fonctionnelle de Holling de type I.\\

L'évolution des prédateurs est la diminution naturelle exponentielle s'il n'y a pas de proies (les prédateurs meurent par manque de nourriture), additionnée de l'influence positive qu'apporte l'interaction des populations Proies-Prédateurs aux prédateurs.\\

Donc $y_1$ représente la population de proies et $y_2$ celles des prédateurs.

\subsection{}

On programme la fonction suivante, qu'on résoudra avec le solveur \textit{ode45()} de MatLab:\\
 \\
 \\ 
\texttt{function yp=predprey(t,y)\\
yp=[1.2*y(1)-0.6*y(1)*y(2) ;-0.8*y(2)+0.3*y(1)*y(2)] ;}\\
 \\
\texttt{[t,y]=ode45(@predprey, tspan, y0);} permet donc de récupérer deux listes t et y grâce au solveur ode45() pour ensuite tracer un graphique des solutions.
De plus, comme la commande renvoie sous le nom 'y' un tableau de deux colonnes (pour $y_1$ et $y_2$), chaque colonne contenant la valeur de l'effectif de la population à l'instant t correspondant à la ligne, on a \texttt{y(:,1)} la liste des valeurs de $y_1$ au cours du temps, et \texttt{y(:,2)} celle des valeurs de $y_2$. Donc la commande \texttt{plot(y(:,1),y(:,2));} nous trace $y_2$ en fonction de $y_1$, c'est à dire le portrait de phases du système dynamique:

\begin{table}[h!]
\centering
\begin{tabular}{ccl}
\subfloat[Coévolution des populations de proies et prédateurs au cours du temps, en unités arbitraires]{\includegraphics[scale=0.5]{ex4_EDOpredpreybis.png}}
&
\subfloat[Portait de phases des populations $y_1$ et $y_2$.]{\includegraphics[scale=0.4]{ex4_EDOpredprey2.png}}
\\
\end{tabular}
\end{table}	
On remarque qu'il s'agit d'une configuration en \textbf{centres}: Les oscillations périodiques sont régulières, et le portrait de phases est une trajectoire fermée cyclique.\\
Pour savoir si ce système dynamique donne des centres, et ceci quelques soient les paramètres, ou non, on procèdera à une étude analytique de ce système.
\subsubsection{Etude Analytique}
$$
(PP)
\left \{
\begin{array}{l}
	y'_1=1.2y_1-0.6y_1y_2\\
	y'_2=-0.8y_2+0.3y_1y_2\\
	y_1(0)=2\\
	y_2(0)=1\\
\end{array}
\right.$$\\
Les équilibres vérifient $y'_1=0$ et $y'_2=0$.\\
Or, $y'_1=0\Leftrightarrow y_1=0$ ou $y_2=\frac{1.2}{0.6}=2$. De même, $y'_2=0\Leftrightarrow y_2=0$ ou $y_1=\frac{0.8}{0.3}=\frac{8}{3}$.\\

Donc \textbf{on a deux équilibres, en ${y_1 \choose y_2}={0 \choose 0}$ et ${2 \choose  8/3}$}. Pour étudier leur stabilité, on linéarise le système au voisinage des points par un développement de Taylor d'ordre 1:\\
Soit $
A=
\left(
\begin{array}{cc}
\frac{\partial y'_1}{y_1} & \frac{\partial y'_1}{y_2} \\
\frac{\partial y'_2}{y_1} & \frac{\partial y'_2}{y_2} \\
\end{array}
\right)
=
\left(
\begin{array}{cc}
1.2-0.6y_2 & -0.6y_1 \\
0.3y_2 & 0.3y_1-0.8 \\
\end{array}
\right)$ la matrice jakobienne du système. On pourra calculer sa valeur à chaque point d'équilibre, et en ces points, si $det(A|_{*})\neq0$, les portraits de phases de la linéarisation et du système sont topologiquement équivalents.
\paragraph{Au point d'équilibre $(0,0)$ :}
$A|_{(0,0)}=
\left(
\begin{array}{cc}
1.2 & 0 \\
0 & -0.8 \\
\end{array}
\right)$: On a deux valeurs propres réelles de signe opposé, $det(A|_{(0,0)})<0$, on peut donc dire que le point d'équilibre $(0,0)$ appartient à la classe d'équivalences topologiques des \textbf{points selles}.

\paragraph{Au point d'équilibre $(\frac{8}{3},2)$ :}
$A|_{\frac{8}{3},2}
\left(
\begin{array}{cc}
0&-1.6 \\
0.6&0 \\
\end{array}
\right)$: On remarque que les valeurs propres sont imaginaires pures. On a $det(A|_{(\frac{3}{8},2)})>0$ et $tr(A|_{(\frac{3}{8},2)})=0$, \textbf{la linéarisation prévoit donc des centres}, mais on ne peut rien conclure.\\

On va chercher à vérifier l'existence de centres par une intégrale première. Posons:
$$\frac{dy_2}{dy_1}=\frac{-0.8y_2+0.3y_1y_2}{1.2y_1-0.6y_1y_2}=\frac{y_2}{(1.2-0.6y_2)}\frac{(0.3y_1-0.8)}{y_1}$$
$$\frac{(0.3y_1-0.8)}{y_1}dy_1=\frac{(1.2-0.6y_2)}{y_2}dy_2$$
Intégrons, $y_1$ et $y_2$ étant positifs:
$$0.3y_1-0.8ln(y_1)=1.2ln(y_2)-0.6y_2+cte$$
Donc la fonction $H(y_1,y_2)=0.3y_1-0.8ln(y_1)-1.2ln(y_2)+0.6y_2$ est donc constante le long des trajectoires du portrait de phases, ses courbes de niveau seront les orbites du système.\\

Approximons $H(y_1,y_2)$ pour $(y_1,y_2)$ proche de $(\frac{3}{8},2)$ par un développement de Taylor à l'ordre 2:
$$H(y_1,y_2)\approx H(3/8,2)+\frac{\partial H}{\partial y_1}|_{(\frac{3}{8},2)}(y_1-\frac{3}{8})+\frac{\partial H}{\partial y_2}|_{(\frac{3}{8},2)}(y_2-2)+\frac{\partial^2 H}{\partial y_1^2}|_{(\frac{3}{8},2)}\frac{(y_1-\frac{3}{8})^2}{2!}+\frac{\partial^2 H}{\partial y_2^2}|_{(\frac{3}{8},2)}\frac{(y_2-2)^2}{2!}+\frac{\partial^2 H}{\partial y_2\partial y_1}|_{(\frac{3}{8},2)}(y_1-\frac{3}{8})(y_2-2)$$
Ce qui se réduit, quand on calcule, à 
$$H(y_1,y_2)\approx H(3/8,2)-\left[\frac{0.3^2}{2*0.8}(y_1-\frac{3}{8})^2+\frac{0.6^2}{2*1.2}(y_2-2)^2\right]$$
$$H(y_1,y_2)\approx 1.26-\left[0.056(y_1-\frac{3}{8})^2+0.15(y_2-2)^2\right]$$
Il s'agit de l'équation d'un paraboloïde centré sur $(\frac{3}{8},2)$. Ainsi, à proximité du point d'équilibre, les courbes de niveau de H sont bien fermées, et donc les orbites du système aussi, donc \textbf{on a bien de réels centres}. la simulation obtenue sur Matlab est cohérente.\\

\textbf{Le centre a pour coordonnées ${\frac{0.8}{0.3} \choose \frac{1.2}{0.6}}$ donc il dépend directement des paramètres du système.} Cependant, le centre existe tant que ces paramètres ont ces signes, donc changer leur valeur ne suffit pas à modifier la stabilité du point d'équilibre.\\
On pourrait les faire changer de signe ou les annuler, mais cette fois, on ne modéliserait plus la cohabitation entre Proies et Prédateurs \textit{(on modéliserait du commensalisme, mutualisme, ou d'autres formes d'interactions)}.\\

\newpage
\subsubsection{Tentative de modification}
On peut cependant chercher à modifier la réponse fonctionnelle pour changer l'équilibre:\\
Si l'on considère que le nombre de proies mangées par prédateur tend vers un maximum asymptotique, on ne modélise plus l'effet de l'interaction par les termes  $-0.6y_1y_2$ et $+0.3y_1y_2$, mais par $-\frac{0.6y_1y_2}{1+0.6y_1}$ et $+\frac{0.6y_1y_2}{1+0.6y_1}$:
$$
(PP')
\left \{
\begin{array}{l}
	y'_1=1.2y_1-\frac{0.6y_1y_2}{1+0.6hy_1}\\
	y'_2=-0.8y_2+\frac{0.6y_1y_2}{1+0.6hy_1}\\
	y_1(0)=2\\
	y_2(0)=1\\
\end{array}
\right.$$
Cette fois, le point d'équilibre est un foyer instable \textit{(On a pris ici h=50)} :\\
\begin{table}[h!]
\centering
\begin{tabular}{ccl}
\subfloat[le nombres de proies mangées par un prédateur par unité de temps tend vers un maximum $\frac{1}{h}$.]{\includegraphics[scale=0.4]{ex4_Holling2.png}}
&
\subfloat[Solutions $y_1$ et $y_2$.]{\includegraphics[scale=0.6]{ex4_Holling.png}}
&
\subfloat[Chroniques des populations $y_1$ et $y_2$.]{\includegraphics[scale=0.6]{ex4_EDOpredprey3.png}}
\\
\end{tabular}
\end{table}\\	
Cependant, ce modèle n'est pas bien réaliste, puisque les populations ne supporteraient pas ces variations de plus en plus extrêmes. \\

Il sera plus plausible de compléter encore l'équation avec une croissance logistique pour les proies: En absence de prédateurs, leur croissance n'est ainsi pas infinie: 
$$
(PP')
\left \{
\begin{array}{l}
	y'_1=1.2y_1(1-\frac{y_1}{K})-\frac{0.6y_1y_2}{1+0.6hy_1}\\
	y'_2=-0.8y_2+\frac{0.6y_1y_2}{1+0.6hy_1}\\
	y_1(0)=2\\
	y_2(0)=1\\
\end{array}
\right.$$
\textit{Avec un milieu capable d'accueillir K=300 individus max, et h=5} :\\
\begin{table}[h!]
\centering
\begin{tabular}{ccl}
\subfloat[Solutions $y_1$ \textit{(bleu)} et $y_2$ \textit{(rouge)}.]{\includegraphics[scale=0.5]{ex4_ultimate3.png}}
&
\subfloat[Portrait de phases]{\includegraphics[scale=0.5]{ex4_ultimate.png}}
&
\subfloat[Chronique des populations]{\includegraphics[scale=0.5]{ex4_ultimate2.png}}
\\
\end{tabular}
\end{table}\\	
On obtient alors un foyer asymptotiquement stable, ce qui est beaucoup plus plausible écologiquement parlant.
\newpage
\section{Exercice 5 - Contrôler les options d'intégration}

\begin{wrapfigure}[1]{r}{7cm}
	\includegraphics[scale=0.55]{ex5_1.png}
\end{wrapfigure}

On considère le problème de Cauchy:
$$
(C2)
\left \{
\begin{array}{l}
y' = 10 e^{-(t-2)^2 / [2(0.075)^2 ]} - 0.6y\\
y_{(0)} = 0.5\\
\end{array}
\right.
$$

Ce qui, en MatLab, donne la fonction suivante:
\begin{verbatim}
function dydt = dydt (t,y)
dydt = 10*exp(-((t-2).^2)/(2*(0.075).^2))-0.6*y
\end{verbatim}

On utilise le solveur \texttt{ode23()} pour approcher la solution, ce qui donne:\\
\vspace{2cm}
\begin{wrapfigure}[1]{r}{7cm}
	\includegraphics[scale=0.55]{ex5_2.png}
\end{wrapfigure}
\vspace{2cm}


En ajoutant l'argument \texttt{odeset(’RelTol’, 1e-4)} à la commande \texttt{ode23()},\\ on force l'utilisation d'un pas de temps adaptatif pour un seuil de tolérance de $10^{-4}$:
\vspace{3cm}

Cette visualisation des intervalles de temps $h$ automatiquement calculés par le solveur, dit \textit{à pas de temps adaptatif}, montre clairement que plus la solution du problème est raide, plus h va diminuer si l'on veut rester en dessous d'un seuil d'erreur choisi ($10^{-4}$ précisé ici dans cet exemple).\\

Ainsi, les problèmes raides mettent plus de temps à être estimés numériquement par des schémas explicites.\\
Comme on l'a vu dans l'exercice 3, les schémas explicites ne sont pas inconditionnellement stables asymptotiquement, donc h s'adapte à la pente.\\
Si on utilisait un schéma implicite, inconditionnellement stable, on pourrait conserver la même valeur de h quelque soit la pente, sans dépasser le seuil d'erreur.

\newpage
\section{Exercice 6 - Matlab et les problèmes raides}

\subsection{}
Considérons l'oscillateur entretenu de Van der Pol, et posons $y=y_1$ et $y'=y_2$.
On obtient le système d'équations:
\[(VDP)
\left\{
\begin{array}{ll}
y''(t)-\mu(1-y^{2}(t))y'(t)+y(t)=0\\
y(0)=y'(0)=1\\
\end{array}
\right.
\Rightarrow
\left\{
\begin{array}{ll}
y_1'=y_2\\
y_2'=\mu(1-y_1^{2})y_2-y_1\\
y_1(0)=y_2(0)=1\\
\end{array}
\right.
\]
\subsection{}
On résout le système précédent dans Matlab avec le solveur \texttt{ode45()}, pour $\mu =1$ et $t \in [0,20]$:
\begin{table}[h!]
\centering
\begin{tabular}{ccc}
\subfloat[Solutions $y_1$ et $y_2$, avec \texttt{ode45()}.]{\includegraphics[scale=0.5]{exo6_2_a.png}}
&
\subfloat[Portrait de phases pour différentes valeurs de $\mu$]{\includegraphics[scale=0.5]{exo6_3_portrait.png}}
&
\subfloat[$y_2$ n'étant que la dérivée de $y_1$, elle ne nous intéresse pas.]{\includegraphics[scale=0.5]{exo6_2_a_1.png}}
\\
\end{tabular}
\end{table}\\
On obtient un portrait de phases en centres, et donc bien des solutions y en forme d'oscillations régulières.\\
\newpage
Matlab comprend plusieurs algorithmes d'approche numérique de solutions d'équations différentielles, suivant divers schémas de Runge-Kutta à pas de temps adaptatifs. Essayons de comparer, pour $\mu =1000$ et $t \in [0,6000]$, les solutions trouvées par \texttt{ode23s()} et \texttt{ode45()}:
\begin{table}[h!]
\centering
\begin{tabular}{cc}
\subfloat[Solution $y$ avec \texttt{ode23s()}.]{\includegraphics[scale=0.7]{exo6_2_b_1.png}}
&
\subfloat[Solution $y$ avec \texttt{ode45()}.]{\includegraphics[scale=0.7]{exo6_2_c_1.png}}
\\
\end{tabular}
\end{table}\\

Conclusion: Pour obtenir exactement la même chose, \texttt{ode45()} utilise un temps de calcul 100 fois plus long. Comment l'expliquer ? Le problème étant très raide de façon périodique, les solveurs à pas de temps adaptatifs vont périodiquement devoir utiliser des pas $h$ minuscules pour que l'erreur entre les deux schémas (Runge-Kutta 2 et 3 pour \texttt{ode23s()}, Runge-Kutta 4 et 5 pour \texttt{ode45()}) reste inférieure au seuil que s'autorise Matlab.\\
Les schémas de Runge-Kutta 4 et 5 étant bien plus précis, l’exigence sur $h$ est plus grande ($h$ est donc pris encore plus petit qu'avec R-K 2 et 3), et donc Matlab devra réaliser plus d'itérations pour parcourir le même intervalle, et donc mettra plus de temps.\\

On remarque également que $\mu$ modifie la période des oscillations, qui a effectivement été multipliée par 1000. On pourrait étudier l'effet de $\mu$ sur la période avec un graphique en 3 dimensions:
\begin{table}
\centering
\begin{tabular}{c}
\subfloat[Chronique de $y$ avec \texttt{ode23s()} avec un pas de 1 pour $\mu$]{\includegraphics[scale=0.7]{exo6_3_pasde1_6.png}}
\\
\end{tabular}
\end{table}
\begin{table}
\begin{tabular}{l}
Ou même, pour y voir plus clair, avec un pas de 20 pour $\mu \in [0,1000]$:\\
\end{tabular}
\\
\begin{tabular}{cc}
\subfloat[Chronique de $y$ avec \texttt{ode23s()}.]{\includegraphics[scale=0.4]{exo6_3_1.png}}
&
\subfloat[Chronique de $y$ avec \texttt{ode45()}.]{\includegraphics[scale=0.4]{exo6_3_ode45_9.png}}
\\
\end{tabular}
\end{table}

\newpage
\section{Annexe: MatLab, critique}
Tentons de rassembler ici quelques informations rassemblées pendant notre étude \textit{objective} sur MatLab:\\
\begin{itemize}
\item Nous avons réalisé les simulations de ce projet sur un ordinateur équipé d'un processeur Intel Xeon$^{(R)}$ E3-1246 v3, c'est un processeur quadri-coeur avec hyperthreading (8 coeurs virtuels) cadencés chacun à 3,50 GHz, et équipés d'un Turbo-boost à 3,9 GHz. Il supporte une bande passante de 26 Go/s. Ce qui, sans être exceptionnel, est plutôt confortable en 2016.
\item L'ordinateur en question est également équipé de 8 Go de RAM, et une partition de Swap de 4 Go (ce qui n'est pas assez, mais bref).
\item le système à vide (Fedora 22) utilise en moyenne 5\% du CPU et 18\% de RAM.\\
\end{itemize}

On se propose d'étudier les performances utilisées en fonction des paramètres choisis dans la simulation de l'exercice 6, qui demande un temps de calcul de plusieurs dizaines de minutes.\\

\subsection{Parallélisation des tâches}
La première remarque qu'on peut faire est que, hormis certaines fonctions d'algèbre \textit{(fft, mldivide, eig, svd, sort)}, Matlab gère mal le multi-coeur: En effet, le logiciel calcule tout avec un CPU et laisse les autres à zéro:
\begin{figure}[h]
\centering
\includegraphics[scale=0.5]{CPU.png}
\end{figure}

\subsection{Erreurs internes de gestion de la mémoire}
Lors de calculs de grands nombres, on aboutit systématiquement non pas à une erreur indiquant que l'on dépasse une éventuelle capacité de calcul maximale, mais à une \textit{erreur de segmentation}, c'est à dire un accès à des zones non autorisées de la RAM. Matlab préfère donc le crash sans sauvegarde possible à toute autre alternative. \\Et cet incident n'est pas ponctuel: lorsqu'un algorithme ne passe pas, il ne passe pas, même après modification et remodification, nous forçant donc à une dizaine de kills de processus avant de trouver un programme stable.\\

On pourrait penser que passé un certain tarif de licence, les développeurs auraient l'initiative de vérifier leur code. 
\begin{table}[h]
\begin{tabular}{cc}
\subfloat[Un détail qui a son importance.]{\includegraphics[scale=0.4]{fail.png}}
&
\subfloat[Un autre détail qui a aussi son importance.]{\includegraphics[scale=0.7]{licence.png}}
\\
\end{tabular}
\end{table}
\newpage
\subsection{Emballement et perte de contrôle}
MatLab ne s'autorise pas de limites et ne détecte pas lorsqu'il ne peut pas. On peut assister à un emballement menant inconditionnellement au crash système:\\
\begin{itemize}
\item On lance un programme nécessitant de stocker beaucoup (trop) de données en mémoire
\item MatLab accapare et sature la RAM et le swap (en plus du CPU occupé par l'exécution du script), ralentissant l'exécution des autres taches, comme la navigation ou la modification d'autres codes
\item L'ordinateur saturé ne répond plus aux commandes: Impossible d'arrêter le script, il y a donc emballement jusqu'au stack overflow et crash système.
\end{itemize}
\begin{figure}[h]
\centering
\includegraphics[scale=0.4]{RA.jpg}
\caption{La RAM déjà saturée, augmentation de la SWAP jusqu'au crash.}
\end{figure}

\textbf{Conclusion: Nous sommes venus utiliser MatLab sans préjugés, force est de constater que, pour une licence payante, le logiciel a été créé avec un certain détachement. Python, avec toute sa lenteur, fonctionne sur tous les ordinateurs gratuitement et sans crash majeur.}


\newpage
\section{Annexe: Codes utilisés (Python 2.7 et MatLab)}
Fichier python contenant des fonctions de schémas numériques à appeler dans les programmes des exercices:\\

\textbf{File: \texttt{schemedo.py}}
\begin{tiny}
\begin{verbatim}
from numpy import arange,ones
from matplotlib.pyplot import plot

def error(approx,exact):
        return abs(approx-exact)/float(exact)*100

def diff(approx,exact):
        return abs(approx-exact)

def eulerExpl( func , I , h , y0 ):
        ti=I[0]
        tf=I[1]
        t=arange(ti,tf+h,h)
        n=len(t)
        y= y0 * ones(n)
        for i in xrange(n-1):
                y[i+1]=y[i] + (t[i+1]-t[i])*func(t[i] , y[i])
        return t,y

def pointMilieu( func , I , h , y0 ):
        ti=I[0]
        tf=I[1]
        t=arange(ti,tf+h,h)
        n=len(t)
        y=y0 * ones(n)
        for i in xrange(n-1):
                y[i+1]=y[i] + (t[i+1]-t[i])*func( t[i]+0.5*h , y[i]+0.5*h*func( t[i], y[i] ))
        return t,y

def RK4( func , I , h , y0 ):
        ti=I[0]
        tf=I[1]
        t=arange(ti,tf+h,h)
        n=len(t)
        y=y0 * ones(n)
        for i in xrange(n-1):
                X1=y[i]
                X2=y[i]+0.5*h*func(t[i],X1)
                X3=y[i]+0.5*h*func(t[i]+0.5*h,X2)
                X4=y[i]+h*func(t[i]+0.5*h,X3)
                y[i+1]=y[i] + h*(1./6*func(t[i],X1) + 1./3*func(t[i]+0.5*h,X2) + 1./3*func(t[i]+0.5*h,X3) + 1./6*func(t[i]+h,X4)   )
        return t,y
\end{verbatim}
\end{tiny}

\newpage
\subsection{Exercice 2: Une mise en jambe pour la programmation}
\textbf{File: \texttt{ex2.py}}
\begin{tiny}
\begin{verbatim}
from numpy import arange, ones
from math import exp
from schemedo import *
import matplotlib.pyplot as plt

def phi(t,y,h):
        return 4*exp(0.8*t)-0.5*y

def y(t):
        return 4/1.3*exp(0.8*t)-1.4/1.3*exp(-0.5*t)


I=[0,100]
y0=2
h=1
t,eulexp=eulerExpl(phi,I,h,y0)
plt.plot(t,eulexp,'r-',label='Euler explicite')
truet=arange(I[0],I[1],0.05)
trueY=map(y, truet)
errors=map(error, eulexp , map(y, t))
print 'errors:',errors


plt.plot(truet,trueY,'g--',label='Solution reelle')
plt.xlabel('t (temps)')
plt.ylabel('solution y(t)')
plt.legend()
plt.title('Apparence des solutions')
plt.show()

\end{verbatim}
\end{tiny}

\newpage
\subsection{Exercice 3: Comparaison entre différentes méthodes}
\textbf{File: \texttt{ex3.py}}
\begin{tiny}
\begin{verbatim}
from schemedo import *
from numpy import linspace
import matplotlib.pyplot as plt
from math import exp

#Partie 1: Etude de la convergence

def f(t,x):
        return -t*x

def solution(t):
        return x0*exp(-0.5*t*t)

I=0
T=6

erreulerexpl=[]
errpointmilieu=[]
errrk=[]
Nrange=range(10,1000,10)

for N in Nrange:
        h=(T-I)/float(N)
        x0=2
        tt=linspace( I , T , 100*(T-I))
	
	
        t, eulerexpl = eulerExpl( f , [I,T] , h , x0 )
        t, pointmilieu = pointMilieu( f , [I,T] , h , x0 )
        t, rk= RK4( f , [I,T] , h , x0 )
	
        erreulerexpl.append(max(map(diff , eulerexpl , map(solution,t) )))
        errpointmilieu.append(max(map(diff , pointmilieu , map(solution,t))))
        errrk.append(max(map(diff , rk , map(solution,t))))
	
	
plt.plot(Nrange,erreulerexpl,'r.',label='Euler Explicite')
plt.plot(Nrange,errpointmilieu, 'g.',label='Point Milieu')
plt.plot(Nrange,errrk, 'b.' , label='Runge-Kutta 4')

plt.plot(Nrange,[ 1./i for i in Nrange],'k')
plt.plot(Nrange,[ 1./(i**2) for i in Nrange],'k')
plt.plot(Nrange,[ 1./(i**3) for i in Nrange],'k')
plt.plot(Nrange,[ 1./(i**4) for i in Nrange],'k')
plt.plot(Nrange,[ 1./(i**5) for i in Nrange],'k')

plt.text(500,5*10**(-15),'1/N^5')
plt.text(500,10**(-12),'1/N^4')
plt.text(500,3*10**(-8),'1/N^3')
plt.text(500,5*10**(-5),'1/N^2')
plt.text(500,8*10**(-3),'1/N')

plt.xscale('log')
plt.yscale('log')
plt.xlabel('N')
plt.ylabel('Erreur absolue max')
plt.legend(loc=2)
plt.show()


#Partie 2: Etude de la stabilite asymptotique


def TLS(t,x):
        return -L*x

def solutionTLS(t):
        return x0*exp(-L*t)
L=8
I=0
T=10
h=1
x0=2

t, eulerexpl = eulerExpl( TLS , [I,T] , h , x0 )
t, pointmilieu = pointMilieu( TLS , [I,T] , h , x0 )
t, rk= RK4( TLS , [I,T] , h , x0 )
tt=linspace(I,T,200)
sol=map(solutionTLS,tt)

plt.plot(tt,sol,'y',label='Solution Exacte')
plt.plot(t,eulerexpl,'r',label='Euler Explicite')
plt.plot(t,pointmilieu, 'g',label='Point Milieu')
plt.plot(t,rk, 'b' , label='Runge-Kutta 4')
plt.title('Test Lineaire Standard, h=1, L=8')
plt.xlabel('t')
plt.legend(loc=1)
plt.ylabel('x(t)')
plt.show()

\end{verbatim}
\end{tiny}

\textbf{File: \texttt{ex3.m}}
\begin{tiny}
\begin{verbatim}
tspan=[0 50]
h=1
y0=4

[t, y] = EulExp('ex3_dydt', tspan, y0, h) ;
disp([t, y])
hold on
plot(t,y,'g')

[t, y] = PointMilieu('ex3_dydt', tspan, y0, h) ;
disp([t, y])
plot(t,y,'r')

[t, y] = RK4('ex3_dydt', tspan, y0, h) ;
disp([t, y])
plot(t,y,'b')
hold off

xlabel('t')
ylabel('y')
ylim([0 4])
legend('Euler Explicite','Point Milieu','Runge-Kutta 4')
title('Stabilité des solutions y selon la méthode choisie')
\end{verbatim}
\end{tiny}
\newpage
\textbf{File: \texttt{EulExp.m}}
\begin{tiny}
\begin{verbatim}
function [t,y]=EulExp (dydt, tspan,y0,h)
ti = tspan(1);
tf = tspan(2);
t = (ti:h:tf)';
n = length(t);  
if t(n) < tf
t(n+1) = tf;
n = n+1;
end
y = y0 * ones(n,1);
for i = 1 : n-1
y(i+1) = y(i) + h*feval(dydt,t(i), y(i)); 
end
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{PointMilieu.m}}
\begin{tiny}
\begin{verbatim}
function [t,y]=PointMilieu (dydt, tspan,y0,h)
ti = tspan(1);
tf = tspan(2);
t = (ti:h:tf)';
n = length(t);  
if t(n) < tf
t(n+1) = tf;
n = n+1;
end
y = y0 * ones(n,1);
for i = 1 : n-1
y(i+1) = y(i) + h*feval(dydt,t(i)+h/2,y(i)+(h/2)*feval(dydt,t(i),y(i))); 
end
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{RK4.m}}
\begin{tiny}
\begin{verbatim}
function [t,y]=RK4 (dydt, tspan,y0,h)
ti = tspan(1);
tf = tspan(2);
t = (ti:h:tf)';
n = length(t);  
if t(n) < tf
t(n+1) = tf;
n = n+1;
end
y = y0 * ones(n,1);
for i = 1 : n-1
    X1=y(i)
    X2=y(i) + (h/2)*feval(dydt,t(i),X1)
    X3=y(i) + (h/2)*feval(dydt,t(i)+(h/2),X2)
    X4=y(i) + h*feval(dydt,t(i)+(h/2),X3) 
    y(i+1) = y(i) + h*((1/6)*feval(dydt,t(i),X1)+(1/3)*feval(dydt,t(i)+(h/2),X2)+(1/3)*feval(dydt,t(i)+(h/2),X3)+(1/6)*feval(dydt,t(i)+h,X4));
end
\end{verbatim}
\end{tiny}
\newpage
\subsection{Exercice 4: Problème d'équation Proie-Prédateur}
\textbf{File: \texttt{ex4.py}}
\begin{tiny}
\begin{verbatim}
import  matplotlib.pyplot as plt
from numpy import *

def holling2(N):
        return 0.6*N/float(1+0.6*h*N)	

n=range(1500)
h=0.02
fn=map(holling2,n)
plt.plot(n,fn,'g')

plt.xlabel('N')
plt.ylabel('f(N)=0.6N/(1+0.6hN)')
plt.title('Proies mangees/predateur/temps = f( proies )')
plt.show()
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{ex4\_predprey.m}}
\begin{tiny}
\begin{verbatim}
function yp=predprey(t,y)
%Lotka-Volterra:
%yp=[1.2*y(1)-0.6*y(1)*y(2) ;-0.8*y(2)+0.3*y(1)*y(2)];
%Lotka-Volterra + Holling type II:
%yp=[1.2*y(1)-0.6*y(1)*y(2)/(1+0.02*0.6*y(1)) ;-0.8*y(2)+0.6*y(1)*y(2)/(1+0.02*0.6*y(1))];
%Holling II pur:
yp=[1.2*y(1)*(1-y(1)/3)-0.6*y(1)*y(2)/(1+0.02*0.6*y(1)) ;-8*y(2)+6*y(1)*y(2)/(1+0.02*0.6*y(1))];
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{ex4\_predpreycompute.m}}
\begin{tiny}
\begin{verbatim}
tspan=[0,50];
y0=[2,1];
[t,y]=ode45(@ex4_predprey, tspan, y0);

%Solutions:
plot(t,y);

%Portrait de phases:
%plot(y(:,1),y(:,2));

%3D:
%plot3(t,y(:,1),y(:,2));
%xlabel('t');
%ylabel('proies');
%zlabel('prédateurs');

\end{verbatim}
\end{tiny}
\subsection{Exercice 5: Contrôler les options d'indexation}
\textbf{File: \texttt{ex5.m}}
\begin{tiny}
\begin{verbatim}
[t,y]=ode23(@ex5_dydt, [0 4], 0.5) ;
options=odeset('RelTol', 1e-4) ;
ode23(@ex_5dydt, [0,4], 0.5, options) ; 
stem(t,y);
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{ex5\_dydt.m}}
\begin{tiny}
\begin{verbatim}
function dydt = dydt (t,y)
dydt = 10*exp(-((t-2).^2)/(2*(0.075).^2))-0.6*y
\end{verbatim}
\end{tiny}

\subsection{Exercice 6: MatLab et les problèmes raides}
\textbf{File: \texttt{exo6.m}}
\begin{tiny}
\begin{verbatim}
%[T,Y]=ode45('exo6_dydt',[0 20], [1 1]) ;
%plot(T,Y(:,1))

%[T,Y]=ode23s('exo6_dydt',[0 6000], [1 1]) ;
%plot(T,Y(:,1));

[T,Y]=ode45('exo6_dydt',[0 6000], [1 1]) ;
plot(T,Y(:,1));
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{exo6\_3.m}}
\begin{tiny}
\begin{verbatim}
%for i =1:20:1000
%        [T,Y]=ode45(@(t,y)[y(2),(i*(1-y(1)*y(1))*y(2)-y(1))]', [0 6000],[1 1]);
%        MU=i*ones(length(T),1);
%        plot3(T,MU,Y(:,1));
%        if (i==1)
%                hold on 
%        end;
%end;
%hold off
%xlabel('t')
%ylabel('mu')
%zlabel('y')

for i =1:200:1000
        [T,Y]=ode23s(@(t,y)[y(2),(i*(1-y(1)*y(1))*y(2)-y(1))]', [0 6000],[1 1]);
        MU=i*ones(length(T),1);
        %plot3(T,MU,Y(:,1));
        plot(Y(:,1),Y(:,2));
        if (i==1)
                hold on 
        end;
end;
hold off
%xlabel('t')
%ylabel('mu')
%zlabel('y')
title('Portrait de phase des solutions y')
\end{verbatim}
\end{tiny}

\textbf{File: \texttt{exo6\_dydt.m}}
\begin{tiny}
\begin{verbatim}
function dy = rigid(t,y)
dy = zeros(2,1) ;
dy(1) = y(2) ;
dy(2) = 1*(1-y(1)^2)*y(2)-y(1) ;
\end{verbatim}
\end{tiny}
\end{document}
